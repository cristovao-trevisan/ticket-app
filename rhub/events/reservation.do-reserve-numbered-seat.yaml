id: reservation.do-reserve-numbered-seat
name: do-reserve-numbered-seat
eventGroup: reservation
version: 0.0.1
model:
  event: Number
  seat: Number
  auth:
    uid: String
filters:
  -
    id: on-event
    name: onEvent
    condition: null
    actions:
      -
        id: firestore
        async: true
        type: GCP
        action: FIRESTORE
        operation: set
        serviceAccountId: google
        template:
          path: '/reservations/{event}'
          merge: true
          payload:
            reservations:
              '{seat}': '{auth.uid}'
      -
        id: postgres
        async: true
        type: POSTGRES
        action: UPDATE
        operation: null
        serviceAccountId: amazon-postgres-rds
        template:
          database: 'ticket-app'
          table: 'NumberedSeats'
          condition:
            -
              field: 'reserved'
              operator: '='
              value: false
            -
              field: 'id'
              operator: '='
              value: '{seat}'
          payload:
            reserved: true
